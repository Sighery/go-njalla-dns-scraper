# go-njalla-dns-scraper

Go program to scrape, and offer an API for [Njalla's][0] DNS records
configuration interface.

Njalla is a privacy-aware domain service. I've recently started to use it and
I quite like them. However, they don't currently provide any official API to
interface with domains' DNS records.

This is useful (and maybe even needed) for when you want to set up things like
[Let's Encrypt SSL certificates][1] with maybe [Certbot][2]. These
certificates are short-lived, for now three months, as they
[explain and cover in their FAQ][3]. They also mention that if it wasn't for
many DNS provides not offering programmatic ways to update DNS records (which
is needed for one of the ways of setting and renewing SSL certificates),
[they'd make them even more short-lived][4].

One way of verifying domain ownership, and getting the SSL certificates, is to
set DNS TXT records with given codes generated by Let's Encrypt/Certbot.
Alternatively, you can also use HTTP to verify the domain ownership, but this
doesn't work (or it requires more work, rather) for wildcard SSL certificates,
which are used to issue SSL certificates to the main domain and all its
subdomains.

Certbot is used to automate all this work. It has plugins that integrate with
other DNS providers and take care of both setting the initial SSL certificate,
and then renewing them with the help of a CRON schedule.

However, since Njalla doesn't provide an API, and it doesn't implement
[RFC 2136][5], there's currently no way to programmatically add, update, and
remove DNS records so I could automate all this work.

## Credits

Even though Njalla doesn't currently provide an official API, there's a
[NodeJS package that scrapes Njalla's website and exposes an API][6]. I've
shamelessly copied most of the code logic when porting it over to Go here.
My utmost thanks to @romualdr for doing all the work of going through the
Njalla website, figuring out how it works, and translating all the needed
requests for the API into code. I can quickly progress in this port only
because they've already done all that time-consuming research work.

## Motivations and Reasoning

A big motivator for this is because I'm lazy and I want to automate renewing
the SSL certificates. However, why Go?

**I don't know Go**. I believe this will become clear to anyone who just
glances at the current code. And the NodeJS package works [(mostly)][7] just
fine. So why would I decide to reinvent the wheel, on a language I don't know?

That is because I want to have my [infrastructure as code][8], managed by
some infrastructure-as-code tool like [Terraform][9]. For now I'm leaning
towards using Terraform, which allows you to create your own providers that
then you can use in your Terraform infrastructure code. Only catch is that
Terraform is written in Go, and therefore the providers must be written in Go
as well.

## Issues and Missing Features

Currently this is more of a script than anything else. It's not a library, and
the email and password values must be written directly into the code. There's
plenty of code duplication, and I'm sure it's inefficient and full of "code
smells" for anyone who knows Go.

**Now, for limitations of the current code:**
* You can't update records
* You can't remove records
* Fetching records will fail if record types other than A, AAAA, MX, or TXT
  are available. This is because other record types have a different data
  structure, but currently the code is targeting the ones mentioned, so it
  will fail with record types that have different columns
* You can only add A, AAAA, MX, and TXT records

This will be slowly solved, as I figure out how write proper Go, how to make
this into a library that can then be used by other Go programs, how to
structure my code in Go, and then add the rest of the missing functionality
that the NodeJS package currently has.

[0]: https://njal.la/
[1]: https://letsencrypt.org/
[2]: https://certbot.eff.org/
[3]: https://letsencrypt.org/docs/faq/#what-is-the-lifetime-for-let-s-encrypt-certificates-for-how-long-are-they-valid
[4]: https://letsencrypt.org/2015/11/09/why-90-days.html
[5]: https://certbot-dns-rfc2136.readthedocs.io/en/stable/
[6]: https://github.com/romualdr/node-njalla-dns
[7]: https://github.com/romualdr/node-njalla-dns/pull/2
[8]: https://en.wikipedia.org/wiki/Infrastructure_as_code
[9]: https://www.terraform.io/
